#### 基础爬虫架构

- 爬虫调度器：负责统筹其他四个模块的协调工作
- URL管理器：管理URL链接，维持已经爬取的URL集合和未爬取的URL集合，提供新的URL链接接口
- HTML下载器： 用于从URL管理器中获取未爬虫的URL链接并下载HTML网页
- HTML解析器：从HTML下载器中获取已经下载的HTML网页，并从中解析出新的URL链接交给URL管理器
- 数据存储器：用于将HTML解析器解析出来的数据通过文件或者数据库形式储存起来



分布式爬虫可以分为若干个分布式层级，不同的应用可能由其中部分层级构成。大型分布式爬虫主要分为以下3个层级：分布式数据中心、分布式抓取服务器及分布式爬虫程序。整个爬虫系统由全球多个分布式数据中心共同组成，每个数据中心负责抓取本地区周边的互联网网页，比如欧洲的数据中心抓取英国、法国、德国等欧洲国家的网页，由于爬虫与要抓取的网页地缘较近，在抓取速度上会较远程抓取快很多。

每个数据中心又由多台高速网络连接的抓取服务器构成，而每台服务器又可以部署多个爬虫程序。通过多层级的分布式爬虫体系，才可能保证抓取数据的及时性和全面性。

对于同一中心的多台抓取服务器，不同机器之间的分工协同方式会有差异，常见的分布式架构有两种：主从分布爬虫和对等分布爬虫。



#### **主从分布式**

对于主从分布式爬虫，不同的服务器承担不同的角色分工，其中有一台专门负责对其他服务器提供URL分发服务，其他机器则进行实际的网页下载。URL服务器维护待抓取URL队列，并从中获得待抓取网页的URL，分配给不同的抓取服务器，另外还要对抓取服务器之间的工作进行负载均衡，使得各服务器承担的工作量大致相等，不至于出现忙闲不均的情况。抓取服务器之间没有通信联系，每个待抓取服务器只和URL服务器进行消息传递。

![img](https://upload-images.jianshu.io/upload_images/1830120-ef02c44133e9502f.png?imageMogr2/auto-orient/)



#### **对等式分布式**

在对等式分布爬虫体系中，服务器之间不存在分工差异，每台服务器承担相同的功能，各自负担一部分URL的抓取工作，下图是其中一种对等式分布爬虫，Mercator爬虫采用此种体系结构。

由于没有URL服务器存在，每台待抓取服务器的任务分工就成为问题。在下图所示的体系结构下，有服务器自己来判断某个URL是否应该由自己来抓取，或者将这个URL传递给相应的服务器。至于采取的判断方法，则是对网址的主域名进行哈希计算，之后取模（即hash【域名】%m，这里的m为服务器个数），如果计算所得的值和服务器编号匹配，则自己下载该网页，否则将网址转发给对应编号的抓取服务器。

![img](https://upload-images.jianshu.io/upload_images/1830120-c33543c243eff1fd.png?imageMogr2/auto-orient/)

用Axure画图